<!DOCTYPE html>
<html lang="ch">

  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>NLP 101: Word Embedding 词嵌入 | Yutian’s Blog</title>
<meta name="generator" content="Jekyll v3.9.4" />
<meta property="og:title" content="NLP 101: Word Embedding 词嵌入" />
<meta name="author" content="Yutian Chen" />
<meta property="og:locale" content="ch" />
<meta name="description" content="什么是词嵌入 在处理自然语言时，模型的输入是文本字符串，然而，我们并不能对字符串进行运算操作。为了解决这个问题，我们尝试将自然语言的词汇转换为一个连续向量空间中的向量。这个过程被称为“词嵌入“。用更加形式化的语言来描述，词嵌入的过程可以这样表达： [\text{Natural Language} \rightarrow \mathbb{R}^n] 用 One-hot 编码进行词嵌入？ 一种符合直觉，也是最简单的词嵌入方法是使用 One-hot 编码。One-hot 编码指一个 $1\times n$ 向量中只有一个分量为1，其它分量都是0。比如说我们现在想将四个单词构成的词汇表转化为向量空间，我们可以这样做：" />
<meta property="og:description" content="什么是词嵌入 在处理自然语言时，模型的输入是文本字符串，然而，我们并不能对字符串进行运算操作。为了解决这个问题，我们尝试将自然语言的词汇转换为一个连续向量空间中的向量。这个过程被称为“词嵌入“。用更加形式化的语言来描述，词嵌入的过程可以这样表达： [\text{Natural Language} \rightarrow \mathbb{R}^n] 用 One-hot 编码进行词嵌入？ 一种符合直觉，也是最简单的词嵌入方法是使用 One-hot 编码。One-hot 编码指一个 $1\times n$ 向量中只有一个分量为1，其它分量都是0。比如说我们现在想将四个单词构成的词汇表转化为向量空间，我们可以这样做：" />
<meta property="og:site_name" content="Yutian’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-24T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="NLP 101: Word Embedding 词嵌入" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yutian Chen"},"dateModified":"2021-11-24T00:00:00+00:00","datePublished":"2021-11-24T00:00:00+00:00","description":"什么是词嵌入 在处理自然语言时，模型的输入是文本字符串，然而，我们并不能对字符串进行运算操作。为了解决这个问题，我们尝试将自然语言的词汇转换为一个连续向量空间中的向量。这个过程被称为“词嵌入“。用更加形式化的语言来描述，词嵌入的过程可以这样表达： [\\text{Natural Language} \\rightarrow \\mathbb{R}^n] 用 One-hot 编码进行词嵌入？ 一种符合直觉，也是最简单的词嵌入方法是使用 One-hot 编码。One-hot 编码指一个 $1\\times n$ 向量中只有一个分量为1，其它分量都是0。比如说我们现在想将四个单词构成的词汇表转化为向量空间，我们可以这样做：","headline":"NLP 101: Word Embedding 词嵌入","mainEntityOfPage":{"@type":"WebPage","@id":"/neural%20network/2021/11/24/Word-Embedding.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/logo.png"},"name":"Yutian Chen"},"url":"/neural%20network/2021/11/24/Word-Embedding.html"}</script>
<!-- End Jekyll SEO tag -->


<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Yutian's Blog" />





<!-- Google Fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open%20Sans|Roboto|Roboto%20Slab|Inconsolata|Dancing%20Script|Noto%20Sans%20SC|Noto%20Sans%20TC|Noto%20Serif%20SC|Noto%20Serif%20TC|Ma%20Shan%20Zheng">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/skin.css">

<!-- Begin selecting skin -->

  <script>
    const hour = (new Date()).getHours();
    let filename = "";
    if (hour >= 5 && hour < 20) {
      filename = "/assets/css/skin-daylight.css";
    } else {
      filename = "/assets/css/skin-daylight.css";
    }
    const elem = document.createElement("link");
    elem.setAttribute("rel", "stylesheet");
    elem.setAttribute("type", "text/css");
    elem.setAttribute("href", filename);
    document.getElementsByTagName("head")[0].appendChild(elem);
  </script>

<!-- End selecting skin -->

<!-- <script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script> -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



<!-- MathJax used to render math equations -->
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

<!-- MS Clarity -->
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "eo4n22qg7z");
</script>


  </head>

  <body>
    <div class="site-container">
      <header class="site-header">
        <div class="wrapper">
  <script>
    function clickSidebarButton() {
      const elem = document.getElementById("site-sidebar")
      if (elem.style.display == "none" || elem.style.display == "") {
        elem.style.display = "block";
      } else {
        elem.style.display = "none";
      }
    }
  </script>
  <a class="site-sidebar-button" onclick="clickSidebarButton()"><i class="fa fa-user-circle"></i>
  </a>

  <a class="site-title" rel="author" href="/">Yutian&#39;s Blog</a>

  
    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger" title="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <ul class="trigger">
              <li><a class="" href="/about/">About</a></li>
            
              <li><a class="" href="/categories/">Posts</a></li>
            
              <li><a class="" href="/files/">Files</a></li>
            
              <li class="dropdown" href="#">
                <a href="javascript:void(0)" class="dropbtn">More</a>
                <div class="dropdown-content">
                    <a class="" href="/tags/">Tags</a>
                    <a class="" href="/years/">Years</a>
                </div>
              </li>
            </ul>
    </nav>
  
</div>

      </header>
      
      <div class="site-body wrapper">
        <aside class="site-sidebar" id="site-sidebar">
          
            <h3 class="toc-title">Table of Contents</h3>
<nav class="toc-nav">
  <ul class="toc">
  <li><a href="#什么是词嵌入">什么是词嵌入</a></li>
  <li><a href="#用-one-hot-编码进行词嵌入">用 One-hot 编码进行词嵌入？</a></li>
  <li><a href="#使用神经网络拟合词嵌入函数">使用神经网络“拟合”词嵌入函数</a></li>
  <li><a href="#nnlm---第一批试图解决nlp问题的神经网络">NNLM - 第一批试图解决NLP问题的神经网络</a>
    <ul>
      <li><a href="#用nnlm预测词汇序列">用NNLM预测词汇序列</a></li>
      <li><a href="#nnlm-构建词嵌入">NNLM 构建词嵌入</a></li>
    </ul>
  </li>
  <li><a href="#word2vec-模型">Word2Vec 模型</a>
    <ul>
      <li><a href="#word2vec-cbow-模型">Word2Vec CBOW 模型</a></li>
      <li><a href="#word2vec-skip-gram-模型">Word2Vec Skip Gram 模型</a></li>
      <li><a href="#cbow-还是-skip-gram">CBOW 还是 Skip Gram?</a></li>
    </ul>
  </li>
  <li><a href="#词嵌入真的能够保留词汇的意思吗">词嵌入真的能够保留词汇的意思吗？</a></li>
  <li><a href="#参考材料">参考材料</a></li>
</ul>

</nav>

          
        </aside>
        <main class="site-main" id="site-main" aria-label="Content" tabindex="1">
          <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title p-name" itemprop="name headline">NLP 101: Word Embedding 词嵌入</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-11-24T00:00:00+00:00" itemprop="datePublished">
        Nov 24, 2021
      </time></p>

  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="什么是词嵌入">什么是词嵌入</h2>

<p>在处理自然语言时，模型的输入是文本字符串，然而，我们并不能对字符串进行运算操作。为了解决这个问题，我们尝试将自然语言的词汇转换为一个连续向量空间中的向量。这个过程被称为“<strong>词嵌入</strong>“。用更加形式化的语言来描述，词嵌入的过程可以这样表达：</p>

\[\text{Natural Language} \rightarrow \mathbb{R}^n\]

<h2 id="用-one-hot-编码进行词嵌入">用 One-hot 编码进行词嵌入？</h2>

<p>一种符合直觉，也是最简单的词嵌入方法是使用 One-hot 编码。One-hot 编码指一个 $1\times n$ 向量中只有一个分量为1，其它分量都是0。比如说我们现在想将四个单词构成的词汇表转化为向量空间，我们可以这样做：</p>

<!--more-->

\[\begin{aligned}
\text{Nice} &amp;\rightarrow [1, 0, 0, 0]\\
\text{to} &amp;\rightarrow [0, 1, 0, 0]\\
\text{meet} &amp;\rightarrow [0, 0, 1, 0]\\
\text{you} &amp;\rightarrow [0, 0, 0, 1]
\end{aligned}\]

<p>但是这样有几个很明显的坏处：</p>

<ul>
  <li>如果我们的词汇表中有 10,000 个单词，作为映射目标的向量空间会拥有 10,000 个维度。这会导致任何试图对词向量进行运算的尝试都需要极大的计算量，也就是常说的“维度灾难”问题</li>
  <li>在进行完词嵌入后，词语的“意思”被完全丢失了。在进行完映射后，任何词语之间的向量距离都是相同的。一个理想的映射应该在进行完词嵌入后尽可能的保留词汇本身的信息。比如我们会希望代表 “my” 和 “me” 的词向量之间的距离小于代表 “me” 和 “sun” 的词向量之间的距离。</li>
</ul>

<h2 id="使用神经网络拟合词嵌入函数">使用神经网络“拟合”词嵌入函数</h2>

<p>为了解决这些问题，我们可以使用一种新的 approach。<strong>假设存在一个理想的函数 $f$ 能够将自然词汇映射为一个有意义的词向量。我们可以训练一个神经网络来拟合这个函数</strong></p>

<p>但是这引入了一个新的问题 - 神经网络在训练过程中需要一个明确定义的损失函数来进行反向传播与参数更新。然而<strong>我们是不知道最佳词嵌入函数的输出的，也就是说如果直接拟合词嵌入函数的话我们没有 Ground Truth / Labeled Data</strong></p>

<p>解决这个问题的方法非常简单：我们<strong>先给神经网络一个已经 well-defined 的问题来进行训练，然后使用训练好的模型在推理阶段来创建自然语言到词向量空间之间的映射</strong>。在寻找词嵌入这个问题上，我们可以在训练阶段给定模型上下文（context）让模型预测在一个特定位置的词的概率分布。</p>

<h2 id="nnlm---第一批试图解决nlp问题的神经网络">NNLM - 第一批试图解决NLP问题的神经网络</h2>

<h3 id="用nnlm预测词汇序列">用NNLM预测词汇序列</h3>

<p>NNLM 是 “Neural Net Language Model” 的缩写。这是第一批用来解决自然语言处理问题的神经网络模型之一。NNLM 一开始的目的是<strong>给定第$n$个到第$n + k - 1$个词汇 ，预测第 $n + k$ 个词汇的概率分布</strong>。</p>

<p>一个NNLM模型由三个部分组成：</p>

<ol>
  <li>
    <p>使用一个参数矩阵 $C$ 将 One-hot 编码的词向量转换为 $\mathbb{R}^n$ 向量空间中的一个向量</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125121222905.png" alt="image-20211125121222905" style="width:500px" /></p>
  </li>
  <li>
    <p>将上一步得到的词向量拼接起来，我们可以得到一个“上下文”向量 $x$。通过一个非线性的隐藏层 $b + Wx + \tanh{(b_2 + W_2x)}$的计算，我们会得到在 $n + k$ 位置的词汇“概率分布”。这里的“概率分布”打了引号因为这时候的向量并不满足一些概率分布的特征：比如各个分量都为非负数且相加之和为1。</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125121235835.png" alt="image-20211125121235835" /></p>
  </li>
  <li>
    <p>为了将最后输出的向量变成真正的概率分布，我们需要用 Softmax 函数处理（正则化）这个向量</p>

    <p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125121729274.png" alt="image-20211125121729274" /></p>
  </li>
</ol>

<h3 id="nnlm-构建词嵌入">NNLM 构建词嵌入</h3>

<p>然而，正如在前文所说的一样，<strong>训练好的NNLM 实际上表示着一种创建词嵌入的函数</strong>。假如我们的词汇表只有四个单词 “Once”, “upon”, “a”, “time”，我们现在给定 “upon” “a” “time”，想预测 “there” 这个位置的词汇。</p>

<p>“Once upon a time <strong>there</strong> …”</p>

<p>这个词汇并不在我们的词汇表中，这种情况下，我们可以将这个词的词向量以“预测结果的词向量的加权和”来定义：</p>

\[C(j) \leftarrow \sum_{i\in V}{C(i)P(i \mid w_{t-n+1}^{t-1})}\]

<p>下面是一个描述这种构建方法的 toy demo</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/image-20211125191009240.png" alt="image-20211125191009240" /></p>

<h2 id="word2vec-模型">Word2Vec 模型</h2>

<p>在<a href="https://arxiv.org/pdf/1301.3781.pdf">Word2Vec 论文</a>中，作者建立了两种不同的神经网络模型来进行词嵌入。</p>

<h3 id="word2vec-cbow-模型">Word2Vec CBOW 模型</h3>

<p>CBOW 是 “Continuous Bag of Words” 的缩写。这是一种用目标词汇周围的单词进行采样的词嵌入模型。</p>

<p>这个模型是基于 NNLM 的基础上进行改进得到的，它与NNLM不一样的地方主要有两点：</p>

<ul>
  <li>
    <p>CBOW为了预测 $t$ 位置的单词，这个模型会接受 $t$ 周围的单词 - $t-1$, $t-2$,…, $t+2$ 位置的词汇，而 NNLM 只会接受 $t$ 之前的单词。</p>
  </li>
  <li>
    <p>NNLM 中在第二部里面会将所有的词向量拼接起来，而 CBOW 会对这些词向量进行按位相加。因为加法是满足交换律的，所以这些输入的词汇的顺序是无关紧要的。这也是为什么这个模型叫做 “Bag of Word” - 词汇的顺序是无关紧要的。</p>
  </li>
</ul>

<p>通过和 NNLM 一样的方法，我们可以从训练好的 CBOW 模型中获得自然语言与词向量空间之间的映射关系。</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_EAF813800A83-1.jpeg" alt="IMG_EAF813800A83-1" /></p>

<h3 id="word2vec-skip-gram-模型">Word2Vec Skip Gram 模型</h3>

<p>Skip Gram 是一种和 CBOW 完全相反的模型 - 给定第 $k$ 个词，Skip gram 模型会预测这个词周边的词的概率分布。</p>

<p><img src="https://markdown-img-1304853431.file.myqcloud.com/IMG_E465C9E1EBF7-1.jpeg" alt="IMG_E465C9E1EBF7-1" /></p>

<h3 id="cbow-还是-skip-gram">CBOW 还是 Skip Gram?</h3>

<p>在论文中，作者表示 Skip-gram 模型在小数据集上表现更好，而且对于词频较低的词汇依然能够较好的提取词向量。而 CBOW 的训练速度普遍高于 Skip-gram 并且对于高词频词汇的词向量估计质量更高。</p>

<h2 id="词嵌入真的能够保留词汇的意思吗">词嵌入真的能够保留词汇的意思吗？</h2>

<p>我认为是可以的！这里是一个论文中举的很神奇的demo：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vec("king") - vec("man") + vec("woman") = vec("queen")
</code></pre></div></div>

<p>也就是说，当你将 “king” 的词向量与 “man”的词向量相减后，你会得到一种表示类似”王权“语义的词向量，当在这个语义的基础上加上表示女性的词向量你就会得到 “queen”。</p>

<h2 id="参考材料">参考材料</h2>

<p>https://arxiv.org/pdf/1301.3781.pdf</p>

<p>https://towardsdatascience.com/nlp-101-word2vec-skip-gram-and-cbow-93512ee24314</p>

<p>https://www.baeldung.com/cs/word-embeddings-cbow-vs-skip-gram</p>

<p>https://zhuanlan.zhihu.com/p/206878986</p>

<p>https://www.youtube.com/watch?v=kEMJRjEdNzM&amp;list=PLoROMvodv4rOhcuXMZkNm7j3fVwBBY42z</p>

  </div>

  <footer class="post-footer">
    
      <div class="post-meta">
        <i class="fa fa-folder-o"></i>
        <ul class="post-taxonomies post-categories">
          
          
            <li class="post-category">
              
              <a href="/categories/#neural-network">Neural Network</a>
            </li>
          
        </ul>
      </div>
    

    
      <div class="post-meta">
        <i class="fa fa-tags"></i>
        <ul class="post-taxonomies post-tags">
          
          
            <li class="post-tag">
              
              <a href="/tags/#machine-learning">machine-learning</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#nlp">nlp</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#neural-network">neural-network</a>
            </li>
          
        </ul>
      </div>
    

    <nav class="post-pagination" role="navigation">
      
        <a class="post-previous" href="/frontend/2021/10/06/magc-map-intro.html">
          <h4 class="post-pagination-label">Prev</h4>
          <span class="post-pagination-title">
            <i class="fa fa-arrow-left"></i> MAGC Map Structural Design

          </span>
        </a>
      

      
        <a class="post-next" href="/neural%20network/2021/12/26/Batch-Normalization.html">
          <h4 class="post-pagination-label">Next</h4>
          <span class="post-pagination-title">
            Batch Normalization 浅入深出
 <i class="fa fa-arrow-right"></i>
          </span>
        </a>
      
    </nav>
  </footer>

  
  
</article>

          <footer class="site-footer">
            <div class="footer-col-wrapper">

  <div class="footer-col">
    <div class="copyright">
      
      
      
      
      <p>Copyright © 2019&nbsp;-&nbsp;2024 Yutian Chen</p>
      
    </div>
    <p>
      Build Version: 08 Jan 2024
    </p>
  </div>

  <div class="footer-col">
    <p>A place for me to Learn, Create and Share</p>
  </div>
</div>

          </footer>
        </main>
      </div>
    </div>
  </body>

</html>
